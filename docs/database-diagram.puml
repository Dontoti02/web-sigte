@startuml SIGTE Database Model

!define COLLECTION #E1F5FE
!define KEY #FFE082

' Estilo
skinparam class {
    BackgroundColor COLLECTION
    BorderColor #01579B
    ArrowColor #01579B
}

' Colección Users
class users <<Collection>> {
    **id**: string {KEY}
    --
    email: string
    firstName: string
    lastName: string
    name: string
    displayName: string
    role: enum (admin|teacher|student|parent)
    photoURL: string
    grade: string (solo students)
    section: string (solo students)
    children: array (solo parents)
}

' Colección Workshops
class workshops <<Collection>> {
    **id**: string {KEY}
    --
    title: string
    description: string
    teacherId: string
    teacherName: string
    schedule: string
    imageUrl: string
    status: enum (active|inactive)
    maxParticipants: number
    enrollmentDeadline: string (ISO)
    participants: array<string>
    restrictByGradeSection: boolean
    allowedSections: array<string>
    allowedGrades: array<string>
}

' Colección Attendances
class attendances <<Collection>> {
    **id**: string {KEY}
    --
    date: string (YYYY-MM-DD)
    workshopId: string
    grade: string
    section: string
    records: array<AttendanceRecord>
}

' Subcampo AttendanceRecord
class AttendanceRecord <<Object>> {
    studentId: string
    studentName: string
    status: enum (present|late|justified|absent|none)
    registeredDate: string
    registeredTime: string
}

' Colección Messages
class messages <<Collection>> {
    **id**: string {KEY}
    --
    senderId: string
    senderName: string
    recipientId: string
    content: string
    timestamp: string (ISO)
    isRead: boolean
}

' Colección Notifications
class notifications <<Collection>> {
    **id**: string {KEY}
    --
    userId: string
    title: string
    description: string
    timestamp: string (ISO)
    isRead: boolean
}

' Relaciones
users "1" -- "0..*" workshops : teacherId
users "0..*" -- "0..*" workshops : participants
workshops "1" -- "0..*" attendances : workshopId
attendances "1" *-- "0..*" AttendanceRecord : records
users "1" -- "0..*" messages : senderId
users "1" -- "0..*" messages : recipientId
users "1" -- "0..*" notifications : userId

' Notas explicativas
note right of users
  **Roles:**
  - admin: Administrador del sistema
  - teacher: Profesor de talleres
  - student: Estudiante
  - parent: Padre de familia
  
  **Campos condicionales:**
  - grade, section: solo para students
  - children: solo para parents
end note

note right of workshops
  **Restricciones:**
  Si restrictByGradeSection = true,
  solo estudiantes en allowedSections
  pueden inscribirse.
  
  **participants:**
  Array de IDs de usuarios inscritos
end note

note right of attendances
  **records:**
  Array de objetos AttendanceRecord
  con la asistencia de cada estudiante
end note

@enduml
