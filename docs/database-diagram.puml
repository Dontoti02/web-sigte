@startuml Modelo de Base de Datos SIGTE

!define COLECCION #E1F5FE
!define CLAVE #FFE082

' Estilo
skinparam class {
    BackgroundColor COLECCION
    BorderColor #01579B
    ArrowColor #01579B
}

' Colección Usuarios
class usuarios <<Colección>> {
    **id**: string {CLAVE}
    --
    email: string
    firstName: string
    lastName: string
    name: string
    displayName: string
    role: enum (admin|teacher|student|parent)
    photoURL: string
    grade: string (solo estudiantes)
    section: string (solo estudiantes)
    children: array (solo padres)
}

' Colección Talleres
class talleres <<Colección>> {
    **id**: string {CLAVE}
    --
    title: string
    description: string
    teacherId: string
    teacherName: string
    schedule: string
    imageUrl: string
    status: enum (active|inactive)
    maxParticipants: number
    enrollmentDeadline: string (ISO)
    participants: array<string>
    restrictByGradeSection: boolean
    allowedSections: array<string>
    allowedGrades: array<string>
}

' Colección Asistencias
class asistencias <<Colección>> {
    **id**: string {CLAVE}
    --
    date: string (AAAA-MM-DD)
    workshopId: string
    grade: string
    section: string
    records: array<RegistroAsistencia>
}

' Subcampo RegistroAsistencia
class RegistroAsistencia <<Objeto>> {
    studentId: string
    studentName: string
    status: enum (present|late|justified|absent|none)
    registeredDate: string
    registeredTime: string
}

' Colección Mensajes
class mensajes <<Colección>> {
    **id**: string {CLAVE}
    --
    senderId: string
    senderName: string
    recipientId: string
    content: string
    timestamp: string (ISO)
    isRead: boolean
}

' Colección Notificaciones
class notificaciones <<Colección>> {
    **id**: string {CLAVE}
    --
    userId: string
    title: string
    description: string
    timestamp: string (ISO)
    isRead: boolean
}

' Relaciones
usuarios "1" -- "0..*" talleres : teacherId
usuarios "0..*" -- "0..*" talleres : participants
talleres "1" -- "0..*" asistencias : workshopId
asistencias "1" *-- "0..*" RegistroAsistencia : records
usuarios "1" -- "0..*" mensajes : senderId
usuarios "1" -- "0..*" mensajes : recipientId
usuarios "1" -- "0..*" notificaciones : userId

' Notas explicativas
note right of usuarios
  **Roles:**
  - admin: Administrador del sistema
  - teacher: Profesor de talleres
  - student: Estudiante
  - parent: Padre de familia
  
  **Campos condicionales:**
  - grade, section: solo para estudiantes
  - children: solo para padres
end note

note right of talleres
  **Restricciones:**
  Si restrictByGradeSection = true,
  solo estudiantes en allowedSections
  pueden inscribirse.
  
  **participants:**
  Array de IDs de usuarios inscritos
end note

note right of asistencias
  **records:**
  Array de objetos RegistroAsistencia
  con la asistencia de cada estudiante
  
  **Estados de asistencia:**
  - present: Presente
  - late: Tardanza
  - justified: Falta justificada
  - absent: Ausente
  - none: Sin registro
end note

@enduml
